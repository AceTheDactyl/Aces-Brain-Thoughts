<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APL 2.0 Interactive Composer | 7,290 Tokens · LIMNUS Integration</title>
    <style>
        :root {
            --bg-void: #030308;
            --bg-panel: rgba(15, 12, 25, 0.95);
            --bg-card: #0d0d12;
            --phi-gold: #ffd700;
            --e-cyan: #22d3ee;
            --pi-magenta: #cc5de8;
            --true-green: #69db7c;
            --untrue-amber: #ffa94d;
            --paradox-red: #ff6b6b;
            --text-primary: rgba(255, 245, 230, 0.9);
            --text-dim: rgba(255, 220, 180, 0.5);
            --border-glow: rgba(168, 85, 247, 0.4);
            --rule: #1a1a24;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg-void);
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            border-bottom: 1px solid var(--rule);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 100;
            letter-spacing: 8px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--phi-gold), var(--e-cyan), var(--pi-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 0.9rem;
            letter-spacing: 3px;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            color: var(--phi-gold);
            font-weight: 300;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-dim);
            letter-spacing: 2px;
        }

        /* Navigation */
        nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        nav a {
            color: var(--text-dim);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        nav a:hover {
            color: var(--phi-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr 300px;
            gap: 20px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Panels */
        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--rule);
            border-radius: 12px;
            padding: 20px;
        }

        .panel-title {
            font-size: 0.85rem;
            letter-spacing: 3px;
            color: var(--phi-gold);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--rule);
        }

        /* Token Composer */
        .composer-section {
            margin-bottom: 20px;
        }

        .composer-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .selector-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .selector-grid.six-col {
            grid-template-columns: repeat(6, 1fr);
        }

        .selector-btn {
            background: var(--bg-card);
            border: 1px solid var(--rule);
            border-radius: 6px;
            padding: 10px 8px;
            color: var(--text-dim);
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .selector-btn:hover {
            border-color: var(--phi-gold);
            color: var(--text-primary);
        }

        .selector-btn.selected {
            background: rgba(255, 215, 0, 0.15);
            border-color: var(--phi-gold);
            color: var(--phi-gold);
        }

        .selector-btn.spiral-phi.selected {
            background: rgba(255, 215, 0, 0.2);
            border-color: var(--phi-gold);
            color: var(--phi-gold);
        }
        .selector-btn.spiral-e.selected {
            background: rgba(34, 211, 238, 0.2);
            border-color: var(--e-cyan);
            color: var(--e-cyan);
        }
        .selector-btn.spiral-pi.selected {
            background: rgba(204, 93, 232, 0.2);
            border-color: var(--pi-magenta);
            color: var(--pi-magenta);
        }

        .selector-btn.truth-t.selected {
            background: rgba(105, 219, 124, 0.2);
            border-color: var(--true-green);
            color: var(--true-green);
        }
        .selector-btn.truth-u.selected {
            background: rgba(255, 169, 77, 0.2);
            border-color: var(--untrue-amber);
            color: var(--untrue-amber);
        }
        .selector-btn.truth-p.selected {
            background: rgba(255, 107, 107, 0.2);
            border-color: var(--paradox-red);
            color: var(--paradox-red);
        }

        /* Current Token Display */
        .token-display {
            background: var(--bg-card);
            border: 2px solid var(--phi-gold);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.4rem;
            letter-spacing: 2px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-all;
        }

        .token-part {
            transition: color 0.2s;
        }

        .token-part.phi { color: var(--phi-gold); }
        .token-part.e { color: var(--e-cyan); }
        .token-part.pi { color: var(--pi-magenta); }
        .token-part.true { color: var(--true-green); }
        .token-part.untrue { color: var(--untrue-amber); }
        .token-part.paradox { color: var(--paradox-red); }

        /* Sentence Builder */
        .sentence-area {
            background: var(--bg-card);
            border: 1px solid var(--rule);
            border-radius: 8px;
            min-height: 150px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
        }

        .sentence-token {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid var(--phi-gold);
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sentence-token:hover {
            background: rgba(255, 107, 107, 0.2);
            border-color: var(--paradox-red);
        }

        .sentence-token.cross-spiral {
            border-style: dashed;
        }

        .sentence-token.tri-spiral {
            border-width: 2px;
            background: linear-gradient(135deg,
                rgba(255, 215, 0, 0.1),
                rgba(34, 211, 238, 0.1),
                rgba(204, 93, 232, 0.1));
        }

        /* Action Buttons */
        .btn-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 100px;
            background: rgba(168, 85, 247, 0.3);
            border: 1px solid rgba(168, 85, 247, 0.5);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.8rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: rgba(168, 85, 247, 0.5);
            transform: translateY(-2px);
        }

        .btn.primary {
            background: rgba(255, 215, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .btn.danger {
            background: rgba(255, 107, 107, 0.3);
            border-color: rgba(255, 107, 107, 0.5);
        }

        /* LIMNUS Visualization */
        #limnus-canvas {
            width: 100%;
            height: 300px;
            background: var(--bg-card);
            border-radius: 8px;
            margin: 15px 0;
        }

        /* Attractor Panel */
        .attractor-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .attractor-btn {
            background: var(--bg-card);
            border: 1px solid var(--rule);
            border-radius: 4px;
            padding: 8px 4px;
            font-size: 0.7rem;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .attractor-btn:hover {
            border-color: var(--pi-magenta);
            color: var(--text-primary);
        }

        .attractor-btn.selected {
            background: rgba(204, 93, 232, 0.2);
            border-color: var(--pi-magenta);
            color: var(--pi-magenta);
        }

        .attractor-btn .alpha {
            font-size: 0.9rem;
            display: block;
            margin-bottom: 2px;
        }

        /* Token Browser */
        .token-browser {
            max-height: 400px;
            overflow-y: auto;
            background: var(--bg-card);
            border-radius: 8px;
            padding: 10px;
        }

        .token-browser::-webkit-scrollbar {
            width: 6px;
        }

        .token-browser::-webkit-scrollbar-track {
            background: var(--bg-card);
        }

        .token-browser::-webkit-scrollbar-thumb {
            background: var(--rule);
            border-radius: 3px;
        }

        .token-item {
            padding: 8px 10px;
            border-bottom: 1px solid var(--rule);
            font-size: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .token-item:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .token-item:last-child {
            border-bottom: none;
        }

        /* Filter/Search */
        .search-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--rule);
            border-radius: 6px;
            padding: 10px 14px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--phi-gold);
        }

        /* Meaning Panel */
        .meaning-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--rule);
        }

        .meaning-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 0.8rem;
        }

        .meaning-label {
            color: var(--text-dim);
        }

        .meaning-value {
            color: var(--phi-gold);
        }

        /* LIMNUS Mapping */
        .limnus-mapping {
            margin-top: 15px;
        }

        .mapping-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid var(--rule);
            font-size: 0.75rem;
        }

        .mapping-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .mapping-dot.phi { background: var(--phi-gold); }
        .mapping-dot.e { background: var(--e-cyan); }
        .mapping-dot.pi { background: var(--pi-magenta); }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            border-top: 1px solid var(--rule);
            color: var(--text-dim);
            font-size: 0.8rem;
        }

        /* Export Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal {
            background: var(--bg-panel);
            border: 1px solid var(--rule);
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.2rem;
            color: var(--phi-gold);
            margin-bottom: 20px;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 15px;
        }

        .tab {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--rule);
            border-radius: 6px 6px 0 0;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--bg-panel);
            border-color: var(--phi-gold);
            border-bottom-color: var(--bg-panel);
            color: var(--phi-gold);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>APL 2.0</h1>
            <div class="subtitle">ALPHA-PHYSICAL LANGUAGE · TRI-SPIRAL OPERATOR SYSTEM</div>
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-value">7,290</div>
                    <div class="stat-label">TOTAL TOKENS</div>
                </div>
                <div class="stat">
                    <div class="stat-value">3</div>
                    <div class="stat-label">SPIRALS</div>
                </div>
                <div class="stat">
                    <div class="stat-value">6</div>
                    <div class="stat-label">INTERACTIONS</div>
                </div>
                <div class="stat">
                    <div class="stat-value">15</div>
                    <div class="stat-label">ATTRACTORS</div>
                </div>
                <div class="stat">
                    <div class="stat-value">95</div>
                    <div class="stat-label">LIMNUS POINTS</div>
                </div>
            </div>
        </header>

        <nav>
            <a href="index.html">← Home</a>
            <a href="limnus-architecture.html">LIMNUS</a>
            <a href="mrp-encoder.html">MRP Encoder</a>
            <a href="apl-manual.html">APL 1.0 Manual</a>
        </nav>

        <div class="main-grid">
            <!-- Left: Token Composer -->
            <div class="panel">
                <div class="panel-title">TOKEN COMPOSER</div>

                <!-- Spiral Selection -->
                <div class="composer-section">
                    <div class="composer-label">SPIRAL (Field Axis)</div>
                    <div class="selector-grid">
                        <button class="selector-btn spiral-phi selected" data-spiral="Φ" onclick="selectSpiral('Φ')">
                            <strong>Φ</strong><br><span style="font-size:0.65rem">Structure</span>
                        </button>
                        <button class="selector-btn spiral-e" data-spiral="e" onclick="selectSpiral('e')">
                            <strong>e</strong><br><span style="font-size:0.65rem">Energy</span>
                        </button>
                        <button class="selector-btn spiral-pi" data-spiral="π" onclick="selectSpiral('π')">
                            <strong>π</strong><br><span style="font-size:0.65rem">Emergence</span>
                        </button>
                    </div>
                </div>

                <!-- Operator Selection -->
                <div class="composer-section">
                    <div class="composer-label">OPERATOR (Direction)</div>
                    <div class="selector-grid">
                        <button class="selector-btn selected" data-op="U" onclick="selectOp('U')">
                            <strong>U</strong><br><span style="font-size:0.65rem">Forward</span>
                        </button>
                        <button class="selector-btn" data-op="D" onclick="selectOp('D')">
                            <strong>D</strong><br><span style="font-size:0.65rem">Backward</span>
                        </button>
                        <button class="selector-btn" data-op="M" onclick="selectOp('M')">
                            <strong>M</strong><br><span style="font-size:0.65rem">Modulate</span>
                        </button>
                    </div>
                </div>

                <!-- Interaction Selection -->
                <div class="composer-section">
                    <div class="composer-label">INTERACTION (Verb)</div>
                    <div class="selector-grid six-col">
                        <button class="selector-btn selected" data-int="B" onclick="selectInt('B')">B<br><span style="font-size:0.55rem">Bound</span></button>
                        <button class="selector-btn" data-int="F" onclick="selectInt('F')">F<br><span style="font-size:0.55rem">Fuse</span></button>
                        <button class="selector-btn" data-int="A" onclick="selectInt('A')">A<br><span style="font-size:0.55rem">Amp</span></button>
                        <button class="selector-btn" data-int="D" onclick="selectInt('D')">D<br><span style="font-size:0.55rem">Decoh</span></button>
                        <button class="selector-btn" data-int="G" onclick="selectInt('G')">G<br><span style="font-size:0.55rem">Group</span></button>
                        <button class="selector-btn" data-int="S" onclick="selectInt('S')">S<br><span style="font-size:0.55rem">Sep</span></button>
                    </div>
                </div>

                <!-- Domain Selection -->
                <div class="composer-section">
                    <div class="composer-label">DOMAIN (Tier)</div>
                    <div class="selector-grid">
                        <button class="selector-btn selected" data-dom="GEO" onclick="selectDom('GEO')">
                            <strong>GEO</strong><br><span style="font-size:0.6rem">Geometry</span>
                        </button>
                        <button class="selector-btn" data-dom="CHEM" onclick="selectDom('CHEM')">
                            <strong>CHEM</strong><br><span style="font-size:0.6rem">Chemistry</span>
                        </button>
                        <button class="selector-btn" data-dom="BIO" onclick="selectDom('BIO')">
                            <strong>BIO</strong><br><span style="font-size:0.6rem">Biology</span>
                        </button>
                    </div>
                </div>

                <!-- Truth Selection -->
                <div class="composer-section">
                    <div class="composer-label">TRUTH STATE</div>
                    <div class="selector-grid">
                        <button class="selector-btn truth-t selected" data-truth="T" onclick="selectTruth('T')">
                            <strong>T</strong><br><span style="font-size:0.6rem">TRUE</span>
                        </button>
                        <button class="selector-btn truth-u" data-truth="U" onclick="selectTruth('U')">
                            <strong>U</strong><br><span style="font-size:0.6rem">UNTRUE</span>
                        </button>
                        <button class="selector-btn truth-p" data-truth="P" onclick="selectTruth('P')">
                            <strong>P</strong><br><span style="font-size:0.6rem">PARADOX</span>
                        </button>
                    </div>
                </div>

                <!-- Attractor Selection -->
                <div class="composer-section">
                    <div class="composer-label">ATTRACTOR (α-STATE)</div>
                    <div class="attractor-grid" id="attractorGrid">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- Current Token -->
                <div class="token-display" id="currentToken">
                    <span class="token-part phi">Φ</span>:<span class="token-part">U</span>:<span class="token-part">B</span>:<span class="token-part">GEO</span>:<span class="token-part true">T</span>:<span class="token-part">α1</span>
                </div>

                <!-- Actions -->
                <div class="btn-row">
                    <button class="btn primary" onclick="addTokenToSentence()">+ ADD TO SENTENCE</button>
                    <button class="btn" onclick="randomToken()">RANDOM</button>
                </div>
            </div>

            <!-- Center: Sentence Builder & Visualization -->
            <div>
                <div class="panel">
                    <div class="panel-title">SENTENCE BUILDER</div>

                    <div class="tabs">
                        <div class="tab active" onclick="switchTab('single')">SINGLE</div>
                        <div class="tab" onclick="switchTab('cross')">CROSS-SPIRAL</div>
                        <div class="tab" onclick="switchTab('tri')">TRI-SPIRAL</div>
                    </div>

                    <div class="tab-content active" id="tab-single">
                        <p style="font-size:0.75rem;color:var(--text-dim);margin-bottom:10px;">
                            Single-spiral tokens: one field axis at a time.
                        </p>
                    </div>
                    <div class="tab-content" id="tab-cross">
                        <p style="font-size:0.75rem;color:var(--text-dim);margin-bottom:10px;">
                            Cross-spiral: synchronized pairs (Φ↔e, Φ↔π, e↔π).
                        </p>
                        <div class="btn-row" style="margin-bottom:10px;">
                            <button class="btn" onclick="addCrossSpiral('Φ','e')">Φ↔e</button>
                            <button class="btn" onclick="addCrossSpiral('Φ','π')">Φ↔π</button>
                            <button class="btn" onclick="addCrossSpiral('e','π')">e↔π</button>
                        </div>
                    </div>
                    <div class="tab-content" id="tab-tri">
                        <p style="font-size:0.75rem;color:var(--text-dim);margin-bottom:10px;">
                            Tri-spiral: full three-field transaction [Φ→e→π].
                        </p>
                        <div class="btn-row">
                            <button class="btn primary" onclick="addTriSpiral()">+ ADD TRI-SPIRAL</button>
                        </div>
                    </div>

                    <div class="sentence-area" id="sentenceArea">
                        <span style="color:var(--text-dim);font-size:0.8rem;">Click "Add to Sentence" to build your APL 2.0 expression...</span>
                    </div>

                    <div class="btn-row">
                        <button class="btn" onclick="parseSentence()">PARSE</button>
                        <button class="btn" onclick="exportSentence()">EXPORT</button>
                        <button class="btn danger" onclick="clearSentence()">CLEAR</button>
                    </div>
                </div>

                <!-- LIMNUS Visualization -->
                <div class="panel" style="margin-top:20px;">
                    <div class="panel-title">LIMNUS GEOMETRY MAPPING</div>
                    <canvas id="limnus-canvas"></canvas>

                    <div class="limnus-mapping">
                        <div class="mapping-row">
                            <div class="mapping-dot phi"></div>
                            <span style="flex:1;">Φ Structure → Prism Layers 0-2 (27 pts)</span>
                            <span style="color:var(--phi-gold);">z &lt; 0.43</span>
                        </div>
                        <div class="mapping-row">
                            <div class="mapping-dot e"></div>
                            <span style="flex:1;">e Energy → Prism Layers 3-4 (18 pts)</span>
                            <span style="color:var(--e-cyan);">0.43 ≤ z &lt; 0.71</span>
                        </div>
                        <div class="mapping-row">
                            <div class="mapping-dot pi"></div>
                            <span style="flex:1;">π Emergence → Prism Layers 5-6 (18 pts)</span>
                            <span style="color:var(--pi-magenta);">z ≥ 0.71</span>
                        </div>
                        <div class="mapping-row" style="border:none;">
                            <div class="mapping-dot" style="background:var(--true-green);"></div>
                            <span style="flex:1;">EM Cage → Boundary Field (32 pts)</span>
                            <span style="color:var(--true-green);">Containment</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Token Browser & Meaning -->
            <div>
                <div class="panel">
                    <div class="panel-title">TOKEN BROWSER</div>
                    <input type="text" class="search-input" placeholder="Search tokens..." id="tokenSearch" oninput="filterTokens()">

                    <div style="font-size:0.7rem;color:var(--text-dim);margin-bottom:10px;">
                        Showing <span id="tokenCount">100</span> of 7,290 tokens
                    </div>

                    <div class="token-browser" id="tokenBrowser">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div class="panel" style="margin-top:20px;">
                    <div class="panel-title">TOKEN MEANING</div>
                    <div id="tokenMeaning">
                        <div class="meaning-section">
                            <div class="meaning-row">
                                <span class="meaning-label">Spiral</span>
                                <span class="meaning-value" id="m-spiral">Φ (Structure)</span>
                            </div>
                            <div class="meaning-row">
                                <span class="meaning-label">Direction</span>
                                <span class="meaning-value" id="m-op">U (Forward)</span>
                            </div>
                            <div class="meaning-row">
                                <span class="meaning-label">Interaction</span>
                                <span class="meaning-value" id="m-int">B (Boundary)</span>
                            </div>
                            <div class="meaning-row">
                                <span class="meaning-label">Domain</span>
                                <span class="meaning-value" id="m-dom">GEO (Tier 1)</span>
                            </div>
                            <div class="meaning-row">
                                <span class="meaning-label">Truth</span>
                                <span class="meaning-value" id="m-truth">TRUE</span>
                            </div>
                            <div class="meaning-row">
                                <span class="meaning-label">Attractor</span>
                                <span class="meaning-value" id="m-alpha">α1 (Isomorphism)</span>
                            </div>
                        </div>
                        <div class="meaning-section">
                            <div class="composer-label">INTERPRETATION</div>
                            <p id="m-interpret" style="font-size:0.8rem;color:var(--text-primary);line-height:1.6;">
                                Define crisp structural edges and facets in geometric space, creating clear boundaries with one-to-one form-meaning mapping.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            APL 2.0 · Alpha-Physical Language · 7,290 Tokens · LIMNUS Integration<br>
            <span style="color:var(--phi-gold);">Φ</span> Structure ·
            <span style="color:var(--e-cyan);">e</span> Energy ·
            <span style="color:var(--pi-magenta);">π</span> Emergence
        </footer>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-title">EXPORT SENTENCE</div>
            <div class="modal-content" id="exportContent"></div>
            <div class="modal-actions">
                <button class="btn" onclick="copyExport()">COPY</button>
                <button class="btn" onclick="downloadExport()">DOWNLOAD</button>
                <button class="btn danger" onclick="closeModal()">CLOSE</button>
            </div>
        </div>
    </div>

    <script>
        // ================================================================
        // APL 2.0 TOKEN SYSTEM
        // 7,290 Tokens: 3 × 3 × 6 × 3 × 3 × 15
        // ================================================================

        const APL = {
            SPIRALS: ['Φ', 'e', 'π'],
            OPS: ['U', 'D', 'M'],  // Forward, Backward, Modulate
            INTS: ['B', 'F', 'A', 'D', 'G', 'S'],
            DOMS: ['GEO', 'CHEM', 'BIO'],
            TRUTHS: ['T', 'U', 'P'],

            ALPHAS: Array.from({length: 15}, (_, i) => `α${i + 1}`),

            ALPHA_NAMES: {
                'α1': 'Isomorphism',
                'α2': 'Iconicity',
                'α3': 'Least Effort',
                'α4': 'Distinctiveness',
                'α5': 'Phono Symmetry',
                'α6': 'Short Dependencies',
                'α7': 'Suffixing Pref',
                'α8': 'Fixed Word Order',
                'α9': 'Harmonic Align',
                'α10': 'Topic/Focus',
                'α11': 'Sem Transparency',
                'α12': 'Morph Bounded',
                'α13': 'Arg Marking',
                'α14': 'Analytic/Synth',
                'α15': 'Discourse Config'
            },

            SPIRAL_INFO: {
                'Φ': { name: 'Structure', desc: 'Form, scaffolding, morphology, constraints', color: '#ffd700' },
                'e': { name: 'Energy', desc: 'Dynamics, flow, gradients, work', color: '#22d3ee' },
                'π': { name: 'Emergence', desc: 'Information, pattern, signaling, cognition', color: '#cc5de8' }
            },

            OP_INFO: {
                'U': { name: 'Forward', desc: 'Projection, pushes state into new configurations' },
                'D': { name: 'Backward', desc: 'Integration, pulls state into memory/consolidation' },
                'M': { name: 'Modulate', desc: 'Coherence-lock, conditional adjustment (UMOL)' }
            },

            INT_INFO: {
                'B': { name: 'Boundary', desc: 'Segmentation, reflection, interface formation' },
                'F': { name: 'Fusion', desc: 'Merging, constructive interaction, unification' },
                'A': { name: 'Amplification', desc: 'Gain, resonance buildup, growth of signal' },
                'D': { name: 'Decoherence', desc: 'Damping, dissipation, noise, loss of order' },
                'G': { name: 'Grouping', desc: 'Synchronization, clustering, phase-locking' },
                'S': { name: 'Separation', desc: 'Splitting, filtering, differentiation' }
            },

            DOM_INFO: {
                'GEO': { name: 'Geometry', tier: 1, desc: 'Shapes, fields, spatial structures' },
                'CHEM': { name: 'Chemistry', tier: 2, desc: 'Reactions, pathways, material scaffolds' },
                'BIO': { name: 'Biology', tier: 3, desc: 'Morphology, metabolism, signaling' }
            },

            TRUTH_INFO: {
                'T': { name: 'TRUE', desc: 'Cross-domain coherent state: tested, repeatable, falsifiable' },
                'U': { name: 'UNTRUE', desc: 'Real but unresolved state: observed, not yet integrated' },
                'P': { name: 'PARADOX', desc: 'Contradiction: cannot stabilize; non-integrable' }
            }
        };

        // Current token state
        let currentToken = {
            spiral: 'Φ',
            op: 'U',
            int: 'B',
            dom: 'GEO',
            truth: 'T',
            alpha: 'α1'
        };

        // Sentence tokens
        let sentence = [];

        // All generated tokens (lazy load subset)
        let allTokens = [];
        let displayedTokens = [];

        // ================================================================
        // TOKEN GENERATION
        // ================================================================

        function generateAllTokens() {
            allTokens = [];
            for (const spiral of APL.SPIRALS) {
                for (const op of APL.OPS) {
                    for (const int of APL.INTS) {
                        for (const dom of APL.DOMS) {
                            for (const truth of APL.TRUTHS) {
                                for (const alpha of APL.ALPHAS) {
                                    allTokens.push({
                                        spiral, op, int, dom, truth, alpha,
                                        str: `${spiral}:${op}:${int}:${dom}:${truth}:${alpha}`
                                    });
                                }
                            }
                        }
                    }
                }
            }
            console.log(`Generated ${allTokens.length} APL 2.0 tokens`);
        }

        function tokenToString(t) {
            return `${t.spiral}:${t.op}:${t.int}:${t.dom}:${t.truth}:${t.alpha}`;
        }

        // ================================================================
        // UI: TOKEN COMPOSER
        // ================================================================

        function selectSpiral(s) {
            currentToken.spiral = s;
            document.querySelectorAll('[data-spiral]').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.spiral === s);
            });
            updateTokenDisplay();
        }

        function selectOp(o) {
            currentToken.op = o;
            document.querySelectorAll('[data-op]').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.op === o);
            });
            updateTokenDisplay();
        }

        function selectInt(i) {
            currentToken.int = i;
            document.querySelectorAll('[data-int]').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.int === i);
            });
            updateTokenDisplay();
        }

        function selectDom(d) {
            currentToken.dom = d;
            document.querySelectorAll('[data-dom]').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.dom === d);
            });
            updateTokenDisplay();
        }

        function selectTruth(t) {
            currentToken.truth = t;
            document.querySelectorAll('[data-truth]').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.truth === t);
            });
            updateTokenDisplay();
        }

        function selectAlpha(a) {
            currentToken.alpha = a;
            document.querySelectorAll('[data-alpha]').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.alpha === a);
            });
            updateTokenDisplay();
        }

        function updateTokenDisplay() {
            const t = currentToken;
            const spiralClass = t.spiral === 'Φ' ? 'phi' : t.spiral === 'e' ? 'e' : 'pi';
            const truthClass = t.truth === 'T' ? 'true' : t.truth === 'U' ? 'untrue' : 'paradox';

            document.getElementById('currentToken').innerHTML = `
                <span class="token-part ${spiralClass}">${t.spiral}</span>:<span class="token-part">${t.op}</span>:<span class="token-part">${t.int}</span>:<span class="token-part">${t.dom}</span>:<span class="token-part ${truthClass}">${t.truth}</span>:<span class="token-part">${t.alpha}</span>
            `;

            updateMeaning();
            updateLimnusViz();
        }

        function updateMeaning() {
            const t = currentToken;

            document.getElementById('m-spiral').textContent = `${t.spiral} (${APL.SPIRAL_INFO[t.spiral].name})`;
            document.getElementById('m-op').textContent = `${t.op} (${APL.OP_INFO[t.op].name})`;
            document.getElementById('m-int').textContent = `${t.int} (${APL.INT_INFO[t.int].name})`;
            document.getElementById('m-dom').textContent = `${t.dom} (Tier ${APL.DOM_INFO[t.dom].tier})`;
            document.getElementById('m-truth').textContent = APL.TRUTH_INFO[t.truth].name;
            document.getElementById('m-alpha').textContent = `${t.alpha} (${APL.ALPHA_NAMES[t.alpha]})`;

            // Generate interpretation
            const spiral = APL.SPIRAL_INFO[t.spiral];
            const op = APL.OP_INFO[t.op];
            const int = APL.INT_INFO[t.int];
            const dom = APL.DOM_INFO[t.dom];
            const alpha = APL.ALPHA_NAMES[t.alpha];

            let interpretation = '';

            if (t.op === 'U') {
                interpretation = `Project ${spiral.name.toLowerCase()} through ${int.name.toLowerCase()} in ${dom.name.toLowerCase()} domain`;
            } else if (t.op === 'D') {
                interpretation = `Integrate ${spiral.name.toLowerCase()} via ${int.name.toLowerCase()} in ${dom.name.toLowerCase()} domain`;
            } else {
                interpretation = `Modulate ${spiral.name.toLowerCase()} with ${int.name.toLowerCase()} in ${dom.name.toLowerCase()} domain`;
            }

            interpretation += `, optimizing for ${alpha.toLowerCase()}.`;

            if (t.truth === 'T') {
                interpretation += ' State is coherent and validated.';
            } else if (t.truth === 'U') {
                interpretation += ' State is observed but unresolved.';
            } else {
                interpretation += ' WARNING: Paradoxical state requires PRS handling.';
            }

            document.getElementById('m-interpret').textContent = interpretation;
        }

        function randomToken() {
            currentToken.spiral = APL.SPIRALS[Math.floor(Math.random() * APL.SPIRALS.length)];
            currentToken.op = APL.OPS[Math.floor(Math.random() * APL.OPS.length)];
            currentToken.int = APL.INTS[Math.floor(Math.random() * APL.INTS.length)];
            currentToken.dom = APL.DOMS[Math.floor(Math.random() * APL.DOMS.length)];
            currentToken.truth = APL.TRUTHS[Math.floor(Math.random() * APL.TRUTHS.length)];
            currentToken.alpha = APL.ALPHAS[Math.floor(Math.random() * APL.ALPHAS.length)];

            // Update UI
            selectSpiral(currentToken.spiral);
            selectOp(currentToken.op);
            selectInt(currentToken.int);
            selectDom(currentToken.dom);
            selectTruth(currentToken.truth);
            selectAlpha(currentToken.alpha);
        }

        // ================================================================
        // UI: SENTENCE BUILDER
        // ================================================================

        function addTokenToSentence() {
            sentence.push({
                type: 'single',
                token: {...currentToken},
                str: tokenToString(currentToken)
            });
            renderSentence();
        }

        function addCrossSpiral(s1, s2) {
            const t1 = {...currentToken, spiral: s1};
            const t2 = {...currentToken, spiral: s2};
            sentence.push({
                type: 'cross',
                spirals: [s1, s2],
                tokens: [t1, t2],
                str: `[${tokenToString(t1)} ↔ ${tokenToString(t2)}]`
            });
            renderSentence();
        }

        function addTriSpiral() {
            const tPhi = {...currentToken, spiral: 'Φ'};
            const tE = {...currentToken, spiral: 'e'};
            const tPi = {...currentToken, spiral: 'π'};
            sentence.push({
                type: 'tri',
                tokens: [tPhi, tE, tPi],
                str: `[Φ→e→π]:${currentToken.op}:${currentToken.int}:${currentToken.dom}:${currentToken.truth}:${currentToken.alpha}`
            });
            renderSentence();
        }

        function renderSentence() {
            const area = document.getElementById('sentenceArea');

            if (sentence.length === 0) {
                area.innerHTML = '<span style="color:var(--text-dim);font-size:0.8rem;">Click "Add to Sentence" to build your APL 2.0 expression...</span>';
                return;
            }

            area.innerHTML = sentence.map((item, idx) => {
                let classes = 'sentence-token';
                if (item.type === 'cross') classes += ' cross-spiral';
                if (item.type === 'tri') classes += ' tri-spiral';
                return `<span class="${classes}" onclick="removeToken(${idx})" title="Click to remove">${item.str}</span>`;
            }).join('');
        }

        function removeToken(idx) {
            sentence.splice(idx, 1);
            renderSentence();
        }

        function clearSentence() {
            sentence = [];
            renderSentence();
        }

        function parseSentence() {
            if (sentence.length === 0) {
                alert('No tokens in sentence to parse.');
                return;
            }

            let analysis = 'APL 2.0 SENTENCE ANALYSIS\n';
            analysis += '='.repeat(40) + '\n\n';

            sentence.forEach((item, idx) => {
                analysis += `[${idx + 1}] ${item.str}\n`;
                analysis += `    Type: ${item.type.toUpperCase()}\n`;

                if (item.type === 'single') {
                    const t = item.token;
                    analysis += `    Spiral: ${t.spiral} (${APL.SPIRAL_INFO[t.spiral].name})\n`;
                    analysis += `    Operation: ${APL.OP_INFO[t.op].name}\n`;
                    analysis += `    Interaction: ${APL.INT_INFO[t.int].name}\n`;
                    analysis += `    Domain: ${APL.DOM_INFO[t.dom].name} (Tier ${APL.DOM_INFO[t.dom].tier})\n`;
                    analysis += `    Truth: ${APL.TRUTH_INFO[t.truth].name}\n`;
                    analysis += `    Attractor: ${APL.ALPHA_NAMES[t.alpha]}\n`;
                } else if (item.type === 'cross') {
                    analysis += `    Cross-spiral: ${item.spirals.join(' ↔ ')}\n`;
                } else if (item.type === 'tri') {
                    analysis += `    Tri-spiral: Φ→e→π (full circuit)\n`;
                }
                analysis += '\n';
            });

            // LIMNUS mapping
            analysis += 'LIMNUS MAPPING\n';
            analysis += '-'.repeat(40) + '\n';

            const phiCount = sentence.filter(s =>
                (s.type === 'single' && s.token.spiral === 'Φ') ||
                (s.type === 'cross' && s.spirals.includes('Φ')) ||
                s.type === 'tri'
            ).length;
            const eCount = sentence.filter(s =>
                (s.type === 'single' && s.token.spiral === 'e') ||
                (s.type === 'cross' && s.spirals.includes('e')) ||
                s.type === 'tri'
            ).length;
            const piCount = sentence.filter(s =>
                (s.type === 'single' && s.token.spiral === 'π') ||
                (s.type === 'cross' && s.spirals.includes('π')) ||
                s.type === 'tri'
            ).length;

            analysis += `Φ Structure activations: ${phiCount} → Prism layers 0-2\n`;
            analysis += `e Energy activations: ${eCount} → Prism layers 3-4\n`;
            analysis += `π Emergence activations: ${piCount} → Prism layers 5-6\n`;

            document.getElementById('exportContent').textContent = analysis;
            document.getElementById('exportModal').classList.add('visible');
        }

        function exportSentence() {
            const output = {
                version: 'APL 2.0',
                timestamp: new Date().toISOString(),
                tokens: sentence.map(s => s.str),
                raw: sentence
            };

            document.getElementById('exportContent').textContent = JSON.stringify(output, null, 2);
            document.getElementById('exportModal').classList.add('visible');
        }

        function closeModal() {
            document.getElementById('exportModal').classList.remove('visible');
        }

        function copyExport() {
            const content = document.getElementById('exportContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                alert('Copied to clipboard!');
            });
        }

        function downloadExport() {
            const content = document.getElementById('exportContent').textContent;
            const blob = new Blob([content], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'apl2-sentence.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // ================================================================
        // UI: TABS
        // ================================================================

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            document.querySelector(`.tab:nth-child(${tab === 'single' ? 1 : tab === 'cross' ? 2 : 3})`).classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        // ================================================================
        // UI: TOKEN BROWSER
        // ================================================================

        function renderTokenBrowser(tokens) {
            const browser = document.getElementById('tokenBrowser');
            const limit = Math.min(tokens.length, 100);

            browser.innerHTML = tokens.slice(0, limit).map(t => `
                <div class="token-item" onclick="loadToken('${t.str}')">${t.str}</div>
            `).join('');

            document.getElementById('tokenCount').textContent = limit;
        }

        function filterTokens() {
            const query = document.getElementById('tokenSearch').value.toUpperCase();

            if (!query) {
                renderTokenBrowser(allTokens);
                return;
            }

            const filtered = allTokens.filter(t => t.str.toUpperCase().includes(query));
            renderTokenBrowser(filtered);
        }

        function loadToken(tokenStr) {
            const parts = tokenStr.split(':');
            if (parts.length !== 6) return;

            currentToken.spiral = parts[0];
            currentToken.op = parts[1];
            currentToken.int = parts[2];
            currentToken.dom = parts[3];
            currentToken.truth = parts[4];
            currentToken.alpha = parts[5];

            selectSpiral(currentToken.spiral);
            selectOp(currentToken.op);
            selectInt(currentToken.int);
            selectDom(currentToken.dom);
            selectTruth(currentToken.truth);
            selectAlpha(currentToken.alpha);
        }

        // ================================================================
        // UI: ATTRACTOR GRID
        // ================================================================

        function renderAttractorGrid() {
            const grid = document.getElementById('attractorGrid');
            grid.innerHTML = APL.ALPHAS.map(a => `
                <button class="attractor-btn ${a === 'α1' ? 'selected' : ''}" data-alpha="${a}" onclick="selectAlpha('${a}')">
                    <span class="alpha">${a}</span>
                    <span style="font-size:0.55rem;">${APL.ALPHA_NAMES[a].slice(0, 8)}</span>
                </button>
            `).join('');
        }

        // ================================================================
        // LIMNUS VISUALIZATION
        // ================================================================

        const limnusCanvas = document.getElementById('limnus-canvas');
        const limnusCtx = limnusCanvas.getContext('2d');

        function initLimnusCanvas() {
            const rect = limnusCanvas.getBoundingClientRect();
            limnusCanvas.width = rect.width * 2;
            limnusCanvas.height = rect.height * 2;
            limnusCtx.scale(2, 2);
        }

        function updateLimnusViz() {
            const ctx = limnusCtx;
            const w = limnusCanvas.width / 2;
            const h = limnusCanvas.height / 2;
            const cx = w / 2;
            const cy = h / 2;

            ctx.fillStyle = '#0d0d12';
            ctx.fillRect(0, 0, w, h);

            // Draw 63-point prism (simplified)
            const prismR = Math.min(w, h) * 0.35;

            // Color based on current spiral
            let activeColor = '#ffd700';
            let activeLayer = 0;

            if (currentToken.spiral === 'Φ') {
                activeColor = '#ffd700';
                activeLayer = 1;
            } else if (currentToken.spiral === 'e') {
                activeColor = '#22d3ee';
                activeLayer = 4;
            } else {
                activeColor = '#cc5de8';
                activeLayer = 6;
            }

            // Draw 7 concentric hexagonal layers
            for (let layer = 0; layer < 7; layer++) {
                const r = prismR * (0.2 + layer * 0.12);
                const isActive = (currentToken.spiral === 'Φ' && layer < 3) ||
                                 (currentToken.spiral === 'e' && layer >= 3 && layer < 5) ||
                                 (currentToken.spiral === 'π' && layer >= 5);

                const alpha = isActive ? 0.8 : 0.2;
                const color = layer < 3 ? '#ffd700' : layer < 5 ? '#22d3ee' : '#cc5de8';

                // Draw hexagon
                ctx.strokeStyle = `rgba(${hexToRgb(color)}, ${alpha})`;
                ctx.lineWidth = isActive ? 2 : 1;
                ctx.beginPath();
                for (let i = 0; i < 6; i++) {
                    const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                    const x = cx + Math.cos(angle) * r;
                    const y = cy + Math.sin(angle) * r;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.stroke();

                // Draw 9 points per layer
                for (let i = 0; i < 9; i++) {
                    const angle = (i / 9) * Math.PI * 2 + layer * 0.2;
                    const x = cx + Math.cos(angle) * r;
                    const y = cy + Math.sin(angle) * r;

                    ctx.fillStyle = `rgba(${hexToRgb(color)}, ${isActive ? 1 : 0.3})`;
                    ctx.beginPath();
                    ctx.arc(x, y, isActive ? 4 : 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Draw EM cage (32 points)
            const cageR = prismR * 1.15;
            ctx.strokeStyle = 'rgba(105, 219, 124, 0.4)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2;
                const x = cx + Math.cos(angle) * cageR;
                const y = cy + Math.sin(angle) * cageR;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.stroke();

            // Label
            ctx.fillStyle = activeColor;
            ctx.font = '14px SF Mono, monospace';
            ctx.textAlign = 'center';
            ctx.fillText(`${currentToken.spiral} Active`, cx, h - 15);
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r}, ${g}, ${b}`;
        }

        // ================================================================
        // INITIALIZATION
        // ================================================================

        function init() {
            generateAllTokens();
            renderAttractorGrid();
            renderTokenBrowser(allTokens);
            initLimnusCanvas();
            updateTokenDisplay();

            window.addEventListener('resize', () => {
                initLimnusCanvas();
                updateLimnusViz();
            });

            console.log('APL 2.0 Interactive Composer initialized');
            console.log(`Total tokens: ${allTokens.length}`);
        }

        init();
    </script>
</body>
</html>
